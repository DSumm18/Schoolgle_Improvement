module.exports=[91404,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(42101),e=a.i(73570),f=a.i(41675),g=a.i(70106);let h=(0,g.default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var i=a.i(24669);let j=(0,g.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var k=a.i(44036);function l({organizationId:a}){let[d,e]=(0,c.useState)([]),[g,l]=(0,c.useState)({}),[m,n]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{async function b(){try{let{data:b,error:c}=await k.supabase.from("school_interventions").select(`
            id,
            cohort_id,
            strategy_id,
            start_date,
            status,
            cohorts:cohort_id (name),
            research_strategies:strategy_id (title)
          `).eq("organization_id",a).order("start_date",{ascending:!1});if(c){console.error("Error fetching interventions:",c),n(!1);return}let d=(b||[]).map(a=>({id:a.id,cohort_id:a.cohort_id,strategy_id:a.strategy_id,start_date:a.start_date,status:a.status,cohort_name:a.cohorts?.name||"Unknown Cohort",strategy_title:a.research_strategies?.title||"Unknown Strategy"}));if(e(d),d.length>0){let a=d.map(a=>a.id),{data:b,error:c}=await k.supabase.from("pulse_checks").select("*").in("intervention_id",a).order("date",{ascending:!0});if(c)console.error("Error fetching pulse checks:",c);else{let a={};(b||[]).forEach(b=>{a[b.intervention_id]||(a[b.intervention_id]=[]),a[b.intervention_id].push(b)}),l(a)}}}catch(a){console.error("Error in fetchData:",a)}finally{n(!1)}}a&&b()},[a]),m)?(0,b.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:(0,b.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),(0,b.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})}):0===d.length?(0,b.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:(0,b.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No interventions found. Create your first intervention to track progress."})}):(0,b.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:(0,b.jsx)("div",{className:"space-y-6",children:d.map(a=>{let c=g[a.id]||[],d=(a=>{if(a.length<2)return null;let b=a.map(a=>a.results.individual_scores&&a.results.individual_scores.length>0?a.results.individual_scores.reduce((a,b)=>a+b.score,0)/a.results.individual_scores.length:a.results.summary?.average||0),c=b[0],d=b[b.length-1]-c;return d>5?"up":d<-5?"down":"stable"})(c);return(0,b.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4 py-2",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.strategy_title}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.cohort_name})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded ${"active"===a.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:a.status}),d&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:["up"===d&&(0,b.jsx)(i.TrendingUp,{className:"text-green-600",size:16}),"down"===d&&(0,b.jsx)(h,{className:"text-red-600",size:16}),"stable"===d&&(0,b.jsx)(j,{className:"text-gray-600",size:16})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-3",children:[(0,b.jsx)(f.Calendar,{size:14}),(0,b.jsxs)("span",{children:["Started: ",new Date(a.start_date).toLocaleDateString("en-GB")]})]}),c.length>0&&(0,b.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Progress Tracking"}),(0,b.jsx)("div",{className:"space-y-2",children:c.map(a=>{let c=a.results.individual_scores&&a.results.individual_scores.length>0?a.results.individual_scores.reduce((a,b)=>a+b.score,0)/a.results.individual_scores.length:a.results.summary?.average||0;return(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"w-20 text-gray-500",children:new Date(a.date).toLocaleDateString("en-GB",{month:"short",day:"numeric"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${Math.min(c,100)}%`}})}),(0,b.jsxs)("span",{className:"text-xs font-medium text-gray-700 w-12 text-right",children:[Math.round(c),"%"]})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:a.topic})]})]},a.id)})})]}),0===c.length&&(0,b.jsx)("p",{className:"text-xs text-gray-400 italic mt-2",children:"No pulse checks recorded yet"})]},a.id)})})})}var m=a.i(16201),n=a.i(41710);let o=(0,g.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var p=a.i(87466);function q({organizationId:a}){let[d,e]=(0,c.useState)([]),[g,h]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{!async function(){if(!a)return h(!1);try{let{data:b,error:c}=await k.supabase.from("pulse_checks").select("id, date, topic, intervention_id, school_interventions!inner(organization_id)").eq("school_interventions.organization_id",a).order("date",{ascending:!1}).limit(5),{data:d,error:f}=await k.supabase.from("school_interventions").select("id, start_date, status, research_strategies(title)").eq("organization_id",a).eq("status","active").limit(5),g=[];b&&b.length>0&&g.push({id:"pulse-checks",type:"pulse_check",title:`${b.length} Pulse Check${b.length>1?"s":""} to Review`,description:"Review recent intervention progress data",priority:"medium",count:b.length}),d&&d.length>0&&g.push({id:"interventions",type:"intervention_update",title:`${d.length} Active Intervention${d.length>1?"s":""}`,description:"Monitor ongoing intervention progress",priority:"high",count:d.length}),e(g)}catch(a){console.error("Error fetching pending actions:",a)}finally{h(!1)}}()},[a]),g)?(0,b.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:(0,b.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),(0,b.jsx)("div",{className:"h-20 bg-gray-200 rounded"})]})}):0===d.length?(0,b.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(f.Calendar,{className:"text-gray-600",size:20}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Morning Briefing"})]}),(0,b.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,b.jsx)(m.CheckCircle,{size:48,className:"mx-auto mb-2 text-green-500 opacity-50"}),(0,b.jsx)("p",{children:"All caught up! No pending actions."})]})]}):(0,b.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(f.Calendar,{className:"text-gray-600",size:20}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Morning Briefing"})]}),(0,b.jsx)("div",{className:"space-y-3",children:d.map(a=>(0,b.jsx)("button",{onClick:()=>{console.log("Action clicked:",a)},className:`w-full text-left p-4 rounded-lg border transition-colors ${(a=>{switch(a){case"high":return"border-red-200 bg-red-50 hover:bg-red-100";case"medium":return"border-yellow-200 bg-yellow-50 hover:bg-yellow-100";default:return"border-blue-200 bg-blue-50 hover:bg-blue-100"}})(a.priority)}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(a=>{switch(a){case"pulse_check":return(0,b.jsx)(m.CheckCircle,{size:20,className:"text-blue-600"});case"intervention_update":return(0,b.jsx)(i.TrendingUp,{size:20,className:"text-green-600"});case"evidence_review":return(0,b.jsx)(p.FileCheck,{size:20,className:"text-purple-600"});default:return(0,b.jsx)(o,{size:20,className:"text-gray-600"})}})(a.type),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.title}),a.count&&(0,b.jsx)("span",{className:"px-2 py-1 bg-white rounded text-xs font-semibold text-gray-700",children:a.count})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.description}),a.dueDate&&(0,b.jsxs)("div",{className:"flex items-center gap-1 mt-2 text-xs text-gray-500",children:[(0,b.jsx)(n.Clock,{size:12}),(0,b.jsxs)("span",{children:["Due: ",new Date(a.dueDate).toLocaleDateString("en-GB")]})]})]})]})},a.id))})]})}function r(){var a,g,m;let n,{user:o,organization:p}=(0,d.useAuth)(),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)(null);if((0,c.useEffect)(()=>{!async function(){if(!p?.id)return u(!1);try{let{data:a,error:b}=await k.supabase.from("organizations").select("urn, name").eq("id",p.id).single();if(b||!a)throw Error("Organization not found");if(!a.urn){w("Organization URN not set. Please add URN to organization record."),u(!1);return}let c=await fetch("/api/risk/profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({urn:a.urn})});if(!c.ok)throw Error("Failed to fetch risk profile");let d=await c.json();s(d)}catch(a){console.error("Error fetching risk profile:",a),w(a instanceof Error?a.message:"Failed to load risk profile")}finally{u(!1)}}()},[p?.id]),t)return(0,b.jsx)("div",{className:"p-8",children:(0,b.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,b.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,b.jsx)("div",{className:"h-64 bg-gray-200 rounded"})]})});if(v)return(0,b.jsx)("div",{className:"p-8",children:(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-3",children:[(0,b.jsx)(e.AlertTriangle,{className:"text-red-600",size:20}),(0,b.jsx)("span",{className:"text-red-800",children:v})]})});let x=o?.user_metadata?.full_name||o?.email?.split("@")[0]||"there",y=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});return(0,b.jsxs)("div",{className:"p-8 space-y-8",children:[(0,b.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:[(n=new Date().getHours())<12?"Good morning":n<17?"Good afternoon":"Good evening",", ",x]}),(0,b.jsxs)("p",{className:"text-gray-600 mt-2",children:[y," • ",r?.schoolName||p?.name||"Schoolgle",r?.urn&&(0,b.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(URN: ",r.urn,")"]})]})]}),p&&(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"Organization"}),(0,b.jsx)("div",{className:"font-semibold text-gray-900 capitalize",children:p.organization_type?.replace("_"," ")})]})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Inspection Risk Assessment"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:"Real-time inspection readiness monitoring"})]}),(0,b.jsx)(q,{organizationId:p?.id||null}),r&&(0,b.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Inspection Risk Score"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Based on current assessment data"})]}),(0,b.jsx)("div",{className:`px-4 py-2 rounded-lg border ${(a=r.riskScore)>=70?"text-red-600 bg-red-50 border-red-200":a>=40?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-green-600 bg-green-50 border-green-200"}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(g=r.riskScore)>=70?(0,b.jsx)(i.TrendingUp,{className:"text-red-600",size:20}):g>=40?(0,b.jsx)(j,{className:"text-yellow-600",size:20}):(0,b.jsx)(h,{className:"text-green-600",size:20}),(0,b.jsx)("span",{className:"font-semibold",children:(m=r.riskScore)>=70?"High Risk":m>=40?"Medium Risk":"Low Risk"})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"h-8 bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full transition-all duration-500 ${r.riskScore>=70?"bg-red-500":r.riskScore>=40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${r.riskScore}%`}})}),(0,b.jsxs)("div",{className:"flex justify-between mt-2 text-xs text-gray-500",children:[(0,b.jsx)("span",{children:"0%"}),(0,b.jsxs)("span",{className:"font-semibold text-gray-900",children:[r.riskScore,"%"]}),(0,b.jsx)("span",{children:"100%"})]})]}),r.lastInspection.date&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(f.Calendar,{className:"text-gray-600",size:18}),(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Last Inspection"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Date:"}),(0,b.jsx)("span",{className:"ml-2 font-medium text-gray-900",children:new Date(r.lastInspection.date).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})})]}),r.lastInspection.rating&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-gray-300",children:"•"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Rating:"}),(0,b.jsx)("span",{className:"ml-2 font-medium text-gray-900",children:r.lastInspection.rating})]})]}),r.lastInspection.daysSince&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-gray-300",children:"•"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Days since:"}),(0,b.jsxs)("span",{className:"ml-2 font-medium text-gray-900",children:[Math.floor(r.lastInspection.daysSince/365)," years, ",Math.floor(r.lastInspection.daysSince%365/30)," months"]})]})]})]})]}),r.headteacher.startDate&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Headteacher"}),r.headteacher.isNew&&(0,b.jsx)("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded",children:"New"})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,b.jsxs)("p",{children:["In post since: ",new Date(r.headteacher.startDate).toLocaleDateString("en-GB",{month:"long",year:"numeric"})]}),null!==r.headteacher.tenureMonths&&(0,b.jsxs)("p",{className:"mt-1",children:["Tenure: ",Math.floor(r.headteacher.tenureMonths/12)," years, ",r.headteacher.tenureMonths%12," months"]})]})]}),(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(f.Calendar,{className:"text-gray-600",size:18}),(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Predicted Inspection Window"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Earliest:"}),(0,b.jsx)("span",{className:"ml-2 font-medium text-gray-900",children:new Date(r.predictedWindow.earliest).toLocaleDateString("en-GB",{month:"long",year:"numeric"})})]}),(0,b.jsx)("span",{className:"text-gray-300",children:"→"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Latest:"}),(0,b.jsx)("span",{className:"ml-2 font-medium text-gray-900",children:new Date(r.predictedWindow.latest).toLocaleDateString("en-GB",{month:"long",year:"numeric"})})]})]})]}),r.riskFactors.length>0&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Key Risk Factors"}),(0,b.jsx)("div",{className:"space-y-2",children:r.riskFactors.map((a,c)=>(0,b.jsxs)("div",{className:`p-3 rounded-lg border ${"high"===a.severity?"bg-red-50 border-red-200":"medium"===a.severity?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"}`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"font-medium text-gray-900",children:a.category}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Impact: ",a.impact,"%"]}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded ${"high"===a.severity?"bg-red-100 text-red-700":"medium"===a.severity?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:a.severity.toUpperCase()})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:a.description})]},c))})]}),r.recommendations&&r.recommendations.length>0&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Recommendations"}),(0,b.jsx)("ul",{className:"space-y-2",children:r.recommendations.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[(0,b.jsx)("span",{className:"text-blue-600 mt-1",children:"•"}),(0,b.jsx)("span",{children:a})]},c))})]})]})]}),p?.id&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Intervention Timeline"}),(0,b.jsx)(l,{organizationId:p.id})]})]})}a.s(["default",()=>r],91404)}];

//# sourceMappingURL=apps_platform_src_app_dashboard_page_tsx_577329f9._.js.map