{"version":3,"sources":["../../src/knowledge-base/index.ts","../../src/knowledge-base/query.ts"],"sourcesContent":["/**\r\n * Knowledge Base module exports\r\n */\r\n\r\nexport * from './query';\r\n","/**\r\n * Knowledge Base Query\r\n * Queries the ed_knowledge_base table for cached answers\r\n */\r\n\r\nimport type {\r\n  Domain,\r\n  ConfidenceLevel,\r\n  KnowledgeEntry,\r\n  KnowledgeQueryOptions,\r\n} from '../types';\r\n\r\n/**\r\n * Query the knowledge base for relevant answers\r\n *\r\n * Note: This is a placeholder implementation. In production, this would\r\n * use the actual Supabase client to query the ed_knowledge_base table.\r\n */\r\nexport async function queryKnowledgeBase(\r\n  question: string,\r\n  domain?: Domain,\r\n  options: KnowledgeQueryOptions = {}\r\n): Promise<KnowledgeEntry | null> {\r\n  // Placeholder - in production, this would be:\r\n  /*\r\n  const supabase = getSupabaseClient();\r\n\r\n  const { data, error } = await supabase.rpc('search_knowledge_base', {\r\n    search_query: question,\r\n    domain_filter: domain || null,\r\n    confidence_filter: options.confidence || 'HIGH',\r\n  });\r\n\r\n  if (error || !data || data.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return transformToKnowledgeEntry(data[0]);\r\n  */\r\n\r\n  // For now, return null (no cached answers)\r\n  return null;\r\n}\r\n\r\n/**\r\n * Get knowledge entry by ID\r\n */\r\nexport async function getKnowledgeEntry(\r\n  id: string\r\n): Promise<KnowledgeEntry | null> {\r\n  // Placeholder implementation\r\n  return null;\r\n}\r\n\r\n/**\r\n * Search knowledge base by topic\r\n */\r\nexport async function searchByTopic(\r\n  topic: string,\r\n  domain: Domain,\r\n  options: KnowledgeQueryOptions = {}\r\n): Promise<KnowledgeEntry[]> {\r\n  // Placeholder implementation\r\n  return [];\r\n}\r\n\r\n/**\r\n * Get knowledge entries due for review\r\n */\r\nexport async function getEntriesDueForReview(\r\n  domain?: Domain\r\n): Promise<KnowledgeEntry[]> {\r\n  // Placeholder implementation\r\n  return [];\r\n}\r\n\r\n/**\r\n * Add new knowledge entry\r\n */\r\nexport async function addKnowledgeEntry(\r\n  entry: Omit<KnowledgeEntry, 'id' | 'version' | 'rank'>\r\n): Promise<KnowledgeEntry> {\r\n  // Placeholder implementation\r\n  return {} as KnowledgeEntry;\r\n}\r\n\r\n/**\r\n * Update existing knowledge entry\r\n */\r\nexport async function updateKnowledgeEntry(\r\n  id: string,\r\n  updates: Partial<Omit<KnowledgeEntry, 'id' | 'version'>>,\r\n  incrementVersion = true\r\n): Promise<KnowledgeEntry | null> {\r\n  // Placeholder implementation\r\n  return null;\r\n}\r\n\r\n/**\r\n * Check if knowledge is stale (needs refresh)\r\n */\r\nexport function isKnowledgeStale(entry: KnowledgeEntry): boolean {\r\n  if (!entry.nextReviewDue) {\r\n    // If no next review date, use defaults based on confidence\r\n    const daysSinceVerified = Date.now() - entry.lastVerified.getTime();\r\n    const daysToReview = entry.confidence === 'HIGH' ? 90 : 30;\r\n    return daysSinceVerified > daysToReview * 24 * 60 * 60 * 1000;\r\n  }\r\n\r\n  return entry.nextReviewDue < new Date();\r\n}\r\n\r\n/**\r\n * Transform database row to KnowledgeEntry\r\n */\r\nfunction transformToKnowledgeEntry(row: any): KnowledgeEntry {\r\n  return {\r\n    id: row.id,\r\n    domain: row.domain,\r\n    topic: row.topic,\r\n    question: row.question,\r\n    answer: row.answer,\r\n    sourceUrl: row.source_url,\r\n    sourceName: row.source_name,\r\n    sourceType: row.source_type,\r\n    confidence: row.confidence,\r\n    lastVerified: new Date(row.last_verified),\r\n    nextReviewDue: row.next_review_due ? new Date(row.next_review_due) : undefined,\r\n    version: row.version,\r\n    rank: row.rank,\r\n  };\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACkBA,eAAsB,mBACpB,UACA,QACA,UAAiC,CAAC,GACF;AAmBhC,SAAO;AACT;AAKA,eAAsB,kBACpB,IACgC;AAEhC,SAAO;AACT;AAKA,eAAsB,cACpB,OACA,QACA,UAAiC,CAAC,GACP;AAE3B,SAAO,CAAC;AACV;AAKA,eAAsB,uBACpB,QAC2B;AAE3B,SAAO,CAAC;AACV;AAKA,eAAsB,kBACpB,OACyB;AAEzB,SAAO,CAAC;AACV;AAKA,eAAsB,qBACpB,IACA,SACA,mBAAmB,MACa;AAEhC,SAAO;AACT;AAKO,SAAS,iBAAiB,OAAgC;AAC/D,MAAI,CAAC,MAAM,eAAe;AAExB,UAAM,oBAAoB,KAAK,IAAI,IAAI,MAAM,aAAa,QAAQ;AAClE,UAAM,eAAe,MAAM,eAAe,SAAS,KAAK;AACxD,WAAO,oBAAoB,eAAe,KAAK,KAAK,KAAK;AAAA,EAC3D;AAEA,SAAO,MAAM,gBAAgB,oBAAI,KAAK;AACxC;","names":[]}